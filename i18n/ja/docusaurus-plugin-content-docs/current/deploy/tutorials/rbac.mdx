---
title: Weaviate での RBAC 設定
description: Weaviate で RBAC （ロールベースアクセス制御）を設定する方法を学びます
image: og/docs/tutorials.jpg
# tags: ['basics']
---

import Link from '@docusaurus/Link';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PyCode from '!!raw-loader!/_includes/code/python/howto.configure.rbac.permissions.py';
import TSCode from '!!raw-loader!/_includes/code/typescript/howto.configure.rbac.permissions.ts';
import RolePyCode from '!!raw-loader!/_includes/code/python/howto.configure.rbac.roles.py';
import UserPyCode from '!!raw-loader!/_includes/code/python/howto.configure.rbac.users.py';
import RoleTSCode from '!!raw-loader!/_includes/code/typescript/howto.configure.rbac.roles.ts';

**Role-Based Access Control (RBAC)** は、Weaviate インスタンスへのアクセスと変更を管理できる強力なセキュリティ機構です。  
このチュートリアルでは、細かく調整した権限を持つロールを定義し、それらをユーザーに割り当てることで Weaviate に RBAC を設定する方法を学びます。  
データの読み書きからコレクションやテナントの管理まで、操作ごとに権限を制御し、許可されたユーザーだけが特定の操作を実行できるようにします。

これから行うステップは次のとおりです。

1. **Weaviate への接続**  
   必要なロール管理権限を持つユーザーで認証されていることを確認します。  
2. **カスタムロールの作成**  
   読み取り、書き込み、テナント管理などの特定の権限を持つロールを定義します。  
3. **ロールを新規ユーザーに割り当てる**  
   これらのロールを新しいユーザーに適用し、リソースごとのアクセスを制限します。

![RBAC Tutorial Diagram](./imgs/rbac-tutorial-diagram.png)

本ガイドを終える頃には、Weaviate デプロイメントに RBAC を実装するための明確な手順を理解し、AI 対応アプリケーションに不可欠なセキュリティ層を追加できるようになります。

---

次のロールを作成します。

- **[読み取り・書き込み権限](#read-and-write-permissions):** `rw_role`  
  コレクションとデータへの読み取りおよび書き込みアクセスを許可するカスタムロールを作成し、ユーザーに割り当てる方法を学びます。
- **[閲覧権限](#viewer-permissions):** `viewer_role`  
  特定のコレクションに対して読み取り専用アクセスに制限するロールを作成します。
- **[テナント権限](#tenant-permissions):** `tenant_manager`  
  テナントの作成、読み取り、更新を行う権限を持つロールを設定します。

## 前提条件

開始前に次のものを用意してください。

- ローカルで Weaviate インスタンスを実行するための Docker
- お好みの Weaviate [クライアントライブラリ](/weaviate/client-libraries/index.mdx)

### ローカルインスタンス - `root` ユーザー

このチュートリアルを進めるには、`root` ロールが割り当てられたユーザーで Weaviate に接続する必要があります。これにより、ロールと権限を管理できます。

Docker Compose ファイル（`docker-compose.yml`）を作成し、次の設定をコピーしてください。

:::info
この設定に含まれる環境変数は以下を行います。

- RBAC を有効化します。
- `root-user` を組み込みの root / admin 権限を持つユーザーとして設定します。
:::

```yaml
---
services:
  weaviate:
    command:
      - --host
      - 0.0.0.0
      - --port
      - '8080'
      - --scheme
      - http
    image: cr.weaviate.io/semitechnologies/weaviate:||site.weaviate_version||
    ports:
      - 8080:8080
      - 50051:50051
    volumes:
      - weaviate_data:/var/lib/weaviate
    restart: on-failure:0
    environment:
      QUERY_DEFAULTS_LIMIT: 25
      PERSISTENCE_DATA_PATH: '/var/lib/weaviate'
      ENABLE_API_BASED_MODULES: 'true'
      CLUSTER_HOSTNAME: 'node1'
      AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED: 'false'
      AUTHORIZATION_ENABLE_RBAC: 'true'
      AUTHORIZATION_RBAC_ROOT_USERS: 'root-user'
      AUTHENTICATION_DB_USERS_ENABLED: 'true'
      AUTHENTICATION_APIKEY_ENABLED: 'true'
      AUTHENTICATION_APIKEY_USERS: 'root-user'
      AUTHENTICATION_APIKEY_ALLOWED_KEYS: 'root-user-key'
 
volumes:
  weaviate_data:
```
:::info
<details>
  <summary> RBAC 関連の環境変数 </summary>

- `AUTHORIZATION_ENABLE_RBAC`: RBAC を有効にします。  
- `AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED`: 匿名ユーザーによる Weaviate インスタンスへのアクセスを有効 / 無効にします。  
- `AUTHENTICATION_DB_USERS_ENABLED`: 実行時ユーザー管理を有効 / 無効にします。  
- `AUTHENTICATION_APIKEY_ENABLED`: API キーによる認証を有効にします。  
- `AUTHENTICATION_APIKEY_USERS`: `AUTHENTICATION_APIKEY_ENABLED` 変数に対応する API キー認証のユーザー ID。  
- `AUTHENTICATION_APIKEY_ALLOWED_KEYS`: 特定のユーザー ID に対応する許可された API キー。  
- `AUTHORIZATION_RBAC_ROOT_USERS`: root / admin ユーザーを定義します。  

その他の環境変数については [こちら](../configuration/env-vars/index.md) を参照してください。
</details>

:::



`root-user` で Weaviate に接続した後、新しいロールを作成し、新しいユーザー `custom-user` を作成してそのロールを割り当てます。

## 読み取り・書き込み権限

### Step 1: Weaviate への接続

ロールを管理できる十分な権限を持つユーザーで Weaviate に接続していることを確認します。  
これは、[Weaviate の設定](/deploy/configuration/configuring-rbac.md)時にあらかじめ定義された `root` ロールを使用するか、ユーザーに [`manage_roles` 権限](/weaviate/configuration/rbac/manage-roles.mdx#role-management-permissions) を付与することで実現できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={RolePyCode}
      startMarker="# START AdminClient"
      endMarker="# END AdminClient"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={RoleTSCode}
      startMarker="// START AdminClient"
      endMarker="// END AdminClient"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>



### ステップ 2: カスタム権限付き新規ロール作成

この設定により、`TargetCollection` で始まるコレクションに対して読み取りおよび書き込み権限が、ノードとクラスターのメタデータに対して読み取り権限が付与されます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ReadWritePermissionDefinition"
      endMarker="# END ReadWritePermissionDefinition"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START ReadWritePermissionDefinition"
      endMarker="// END ReadWritePermissionDefinition"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

### ステップ 3: 新しいユーザーへのロール割り当て

まず、新しいユーザー `custom-user` を作成します:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={UserPyCode}
      startMarker="# START CreateUser"
      endMarker="# END CreateUser"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">

```ts
// TS support coming soon
```

  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

次に、ロール `rw_role` を `custom-user` に割り当てます:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ReadWritePermissionAssignment"
      endMarker="# END ReadWritePermissionAssignment"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START ReadWritePermissionAssignment"
      endMarker="// END ReadWritePermissionAssignment"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

## 閲覧者権限

### ステップ 1: Weaviate への接続

ロールを管理するのに十分な権限を持つユーザーで Weaviate に接続していることを確認してください。  
これは、[Weaviate の設定](/deploy/configuration/configuring-rbac) であらかじめ定義されている `root` ロールを使用するか、ユーザーに [`manage_roles` 権限](/weaviate/configuration/rbac/manage-roles#role-management) を付与することで実現できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={RolePyCode}
      startMarker="# START AdminClient"
      endMarker="# END AdminClient"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={RoleTSCode}
      startMarker="// START AdminClient"
      endMarker="// END AdminClient"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>



### ステップ 2: カスタム権限を持つ新規ロールの作成

これにより、`TargetCollection` で始まるコレクションに対して viewer 権限が付与されます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ViewerPermissionDefinition"
      endMarker="# END ViewerPermissionDefinition"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START ViewerPermissionDefinition"
      endMarker="// END ViewerPermissionDefinition"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

### ステップ 3: 新規ユーザーへのロールの割り当て

まず、新しいユーザー `custom-user` を作成します:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={UserPyCode}
      startMarker="# START CreateUser"
      endMarker="# END CreateUser"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">

```ts
// TS support coming soon
```

  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

次に、`custom-user` にロール `viewer_role` を割り当てます:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START ViewerPermissionAssignment"
      endMarker="# END ViewerPermissionAssignment"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START ViewerPermissionAssignment"
      endMarker="// END ViewerPermissionAssignment"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

## テナント権限

### ステップ 1: Weaviate への接続

ロールを管理できる十分な権限を持つユーザーで Weaviate に接続していることを確認してください。  
これは、[Weaviate の設定](/deploy/configuration/configuring-rbac.md) 時にあらかじめ定義されている `root` ロールを使用するか、ユーザーに [`manage_roles` 権限](/weaviate/configuration/rbac/manage-roles.mdx#role-management-permissions) を付与することで実現できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={RolePyCode}
      startMarker="# START AdminClient"
      endMarker="# END AdminClient"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={RoleTSCode}
      startMarker="// START AdminClient"
      endMarker="// END AdminClient"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

### ステップ 2: カスタム権限を持つ新しいロールの作成

このロールにより、以下の権限が付与されます:
- `TargetCollection` で始まるコレクション内において、`TargetTenant` で始まるテナントを完全に管理できます。
- `TargetCollection` で始まるコレクション内において、`TargetTenant` で始まるテナントのデータを作成・読み取り・更新・削除できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START MTPermissionsExample"
      endMarker="# END MTPermissionsExample"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START MTPermissionsExample"
      endMarker="// END MTPermissionsExample"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

### ステップ 3: 新規ユーザーへのロール割り当て

まず、新しいユーザー `custom-user` を作成します:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={UserPyCode}
      startMarker="# START CreateUser"
      endMarker="# END CreateUser"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">

```ts
// TS support coming soon
```

  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

次に、`custom-user` にロール `tenant_manager` を割り当てます:

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START MTPermissionsAssignment"
      endMarker="# END MTPermissionsAssignment"
      language="py"
    />
  </TabItem>
  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START MTPermissionsAssignment"
      endMarker="// END MTPermissionsAssignment"
      language="ts"
    />
  </TabItem>
  <TabItem value="go" label="Go">

```go
// Go support coming soon
```

  </TabItem>
  <TabItem value="java" label="Java">

```java
// Java support coming soon
```

  </TabItem>
</Tabs>

## まとめ

本チュートリアルでは、 Weaviate の RBAC を設定してユーザーアクセスをカスタマイズしたロールと権限で管理し、ベクトルデータベースを安全に運用する方法を包括的に解説しました。

ロール管理権限を持つユーザーで Weaviate に接続する手順を示し、その後さまざまなアクセスレベルに合わせてカスタムロールを作成する方法を紹介しました。コレクションとデータを管理できる読取・書込権限を持つロール、閲覧専用のビューアー権限、テナント操作を管理するテナント権限の設定方法を学べます。

## 追加リソース

- [ RBAC：設定](/deploy/configuration/configuring-rbac.md)
- [ RBAC：ロール管理](/weaviate/configuration/rbac/manage-roles.mdx)
- [ RBAC：ユーザー管理](/weaviate/configuration/rbac/manage-users.mdx)

## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback />

