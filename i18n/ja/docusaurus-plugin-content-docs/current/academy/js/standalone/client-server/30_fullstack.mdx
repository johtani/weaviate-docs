---
title: フルスタック Web フレームワークの利用
---

import Tabs from '@theme/Tabs';  
import TabItem from '@theme/TabItem';  
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';  
import WeaviateTypescriptImgUrl from '/docs/academy/js/standalone/client-server/_img/fullstack.jpg';  
import TSCode from '!!raw-loader!./_snippets/20_backend.js';  

このアプローチでは、サーバーアプリケーションとクライアントアプリケーションの両方を 1 つのツールで構築します。最新の Web 開発用語では、このようなツールをフルスタック Web フレームワークと呼びます。本ガイドでは [Next.js](https://nextjs.org/) を使用します。

<img src={WeaviateTypescriptImgUrl} alt="Image alt" width="100%"/>

## <i class="fa-solid fa-chalkboard"></i> Next.js での構築

### 1. Next.js アプリケーションの作成

Next.js で新しいアプリケーションを作成するには、ターミナルで次のコマンドを実行します。

```bash
create-next-app <project-name> –ts –app
```  

### 2. プロジェクト依存関係のインストール

プロジェクトを初期化したら、`weaviate-client` をインストールして Weaviate データベースとの通信を管理します。

```bash
npm install weaviate-client 
```  

### 3. Weaviate データベースのセットアップ

まず [Weaviate Cloud](https://console.weaviate.cloud/) で無料のサンドボックスアカウントを作成します。サンドボックスプロジェクトの設定に問題がある場合は、[こちらのガイド](/cloud/manage-clusters/connect) を参照してください。

Weaviate クラスターの URL と API キーが必要です。まだ持っていない場合は Cohere の [API キー](https://dashboard.cohere.com/api-keys) を新しく作成してください。Embedding モデルとして Cohere を使用します（[詳細](../using-ml-models/10_embedding.mdx)）。完了したら、3 つすべてを `.env` ファイルに追加します。

 <TabItem value="js" label=".env">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START .env"
      endMarker="// END .env"
      language="js"
    />
  </TabItem>

#### 3.5 Weaviate へのデータ追加

[データ読み込みレシピ](https://github.com/weaviate/recipes-ts/blob/main/similarity-search/cohere/load.ts) に従い、Weaviate にデータをインポートします。

### 4. Weaviate の初期化

`utils/weaviate.ts` にファイルを作成し、次のコードを貼り付けます。このコードは Weaviate Cloud 上でホストされている Weaviate インスタンスへの接続を作成します。

```ts
import weaviate from "weaviate-client";

const client = await weaviate.connectToWeaviateCloud(process.env.WEAVIATE_URL as string,{
    authCredentials: new weaviate.ApiKey(process.env.WEAVIATE_API_KEY as string),
    headers: {
      'X-Cohere-Api-Key': process.env.COHERE_API_KEY as string
    }
  },
);
```  

### 4. Search Server Action の作成

次に `./utils/action.ts` に以下のコードを貼り付けます。これにより、`nearText()` を使ったセマンティック検索を `vectorSearch()` 関数としてアプリケーションの他の場所から呼び出せます。

```ts
"use server";

import { connectToDB } from './weaviate.ts'

export async function vectorSearch(searchTerm: string) {
  
  const myCollection = client.collections.get('MyCollectionName');

  const response = await myCollection.query.nearText(searchTerm, {
      limit: 8,
      returnMetadata: ['distance'],
    })

  return response
  }
```  

### 5. クライアントアプリケーションでサーバーからデータを取得する

`./app` フォルダーの `page.tsx` に次のコードを貼り付けます。クライアント側で検索を実行し、結果を Web ページに表示します。

```tsx

import { vectorSearch } from '@/utils/action.ts';

export default async function Home() {
  const search = "water sports i can win a medal in"
  const data = await vectorSearch(search);

  return (
    <html lang="en">
      <body>
        <h1>
          { data }
          </h1>
        </body>
    </html>
  )

}
      
```  

#### 6. フルスタックアプリの実行

ターミナルで次のコマンドを実行してアプリケーションを起動します。

```bash
npm run dev
```  

アプリケーションは `localhost:3000` で動作しているはずです。

## <i class="fa-solid fa-chalkboard"></i> その他のフレームワーク

本ガイドでは Next.js のみを扱いましたが、[Nuxt](https://nuxt.com/)、[Solid](https://www.solidjs.com/)、[Angular](https://angular.dev/) など複数のフルスタックフレームワークで Weaviate を利用できます。

試せる [スターター](https://github.com/topics/weaviate-starter) アプリケーションも用意しています。