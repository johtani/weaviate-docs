---
title: キーワード検索
sidebar_position: 40
image: og/docs/howto.jpg
# tags: ['how to', 'similarity search']
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import FilteredTextBlock from '@site/src/components/Documentation/FilteredTextBlock';
import PyCode from '!!raw-loader!/_includes/code/howto/search.bm25.py';
import PyCodeV3 from '!!raw-loader!/_includes/code/howto/search.bm25-v3.py';
import TSCode from '!!raw-loader!/_includes/code/howto/search.bm25.ts';
import TSCodeLegacy from '!!raw-loader!/_includes/code/howto/search.bm25-v2.ts';
import GoCode from '!!raw-loader!/_includes/code/howto/go/docs/mainpkg/search-bm25_test.go';
import JavaCode from '!!raw-loader!/_includes/code/howto/java/src/test/java/io/weaviate/docs/search/KeywordSearchTest.java';
import GQLCode from '!!raw-loader!/_includes/code/howto/search.bm25.gql.py';

`Keyword` 検索は、" BM25 (Best match 25)" または "スパース ベクトル" 検索とも呼ばれ、最も高い BM25F スコアを持つオブジェクトを返します。

## 基本 BM25 検索

BM25 キーワード検索を使用するには、検索文字列を定義します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# BM25BasicPython"
      endMarker="# END BM25BasicPython"
      language="python"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25BasicPython"
      endMarker="# END BM25BasicPython"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START Basic"
      endMarker="// END Basic"
      language="js"
    />
  </TabItem>

   <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START Basic"
      endMarker="// END Basic"
      language="tsv2"
    />
  </TabItem>

   <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Basic"
      endMarker="// END Basic"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START Basic"
      endMarker="// END Basic"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25BasicGraphQL"
      endMarker="# END BM25BasicGraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>例: レスポンス</summary>

レスポンスは次のようになります:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# Expected BM25Basic results"
  endMarker="# END Expected BM25Basic results"
  language="json"
/>

</details>

## 検索演算子

:::info Added in `v1.31`
:::

検索演算子は、オブジェクトが返されるために含まれていなければならないクエリ [トークン](#set-tokenization) の最小数を定義します。指定できるオプションは `and` と `or` (デフォルト) です。

### `or`

`or` 演算子を使用すると、検索文字列のトークンのうち少なくとも `minimumOrTokensMatch` 個を含むオブジェクトが返されます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START BM25OperatorOrWithMin"
      endMarker="# END BM25OperatorOrWithMin"
      language="python"
    />
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={GQLCode}
      startMarker="# START BM25OperatorOrWithMin"
      endMarker="# END BM25OperatorOrWithMin"
      language="python"
    />
  </TabItem>
</Tabs>
### `and`

`and` オペレーターを使用すると、検索文字列に含まれるすべてのトークンを含むオブジェクトのみが返されます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START BM25OperatorAnd"
      endMarker="# END BM25OperatorAnd"
      language="python"
    />
  </TabItem>
  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={GQLCode}
      startMarker="# START BM25OperatorAnd"
      endMarker="# END BM25OperatorAnd"
      language="python"
    />
  </TabItem>
</Tabs>

## BM25F スコアの取得

返された各オブジェクトについて、BM25F の `score` 値を取得できます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# BM25WithScorePython"
      endMarker="# END BM25WithScorePython"
      language="python"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithScorePython"
      endMarker="# END BM25WithScorePython"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START Score"
      endMarker="// END Score"
      language="js"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START Score"
      endMarker="// END Score"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Score"
      endMarker="// END Score"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START Score"
      endMarker="// END Score"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithScoreGraphQL"
      endMarker="# END BM25WithScoreGraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>Example response</summary>

The response is like this:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# Expected BM25WithScore results"
  endMarker="# END BM25WithScore results"
  language="json"
/>

</details>

## 特定のプロパティのみを検索

:::info `v1.19.0` で追加
:::

キーワード検索は、オブジェクトのプロパティの一部だけを対象にするよう制限できます。この例では、BM25 検索は `question` プロパティのみを使用して BM25F スコアを算出します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# BM25WithPropertiesPython"
      endMarker="# END BM25WithPropertiesPython"
      language="python"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithPropertiesPython"
      endMarker="# END BM25WithPropertiesPython"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START Properties"
      endMarker="// END Properties"
      language="js"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START Properties"
      endMarker="// END Properties"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Properties"
      endMarker="// END Properties"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START Properties"
      endMarker="// END Properties"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithPropertiesGraphQL"
      endMarker="# END BM25WithPropertiesGraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>Example response</summary>

The response is like this:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# Expected BM25WithProperties results"
  endMarker="# END BM25WithProperties results"
  language="json"
/>
</details>
## プロパティの重み付けブースト

:::info `v1.19.0` で追加
:::

各プロパティが全体の BM25F スコアにどの程度影響するかを重み付けできます。次の例では、`question` プロパティを 2 倍にブーストし、`answer` プロパティは変更しません。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# BM25WithBoostedPropertiesPython"
      endMarker="# END BM25WithBoostedPropertiesPython"
      language="python"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithBoostedPropertiesPython"
      endMarker="# END BM25WithBoostedPropertiesPython"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START Boost"
      endMarker="// END Boost"
      language="js"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START Boost"
      endMarker="// END Boost"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START Boost"
      endMarker="// END Boost"
      language="java"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Boost"
      endMarker="// END Boost"
      language="go"
    />
  </TabItem>


  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithBoostedPropertiesGraphQL"
      endMarker="# END BM25WithBoostedPropertiesGraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>例示的なレスポンス</summary>

レスポンスの例:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# Expected BM25WithBoostedProperties results"
  endMarker="# END Expected BM25WithBoostedProperties results"
  language="json"
/>

</details>


## トークナイゼーションの設定

BM25 クエリ文字列は、転置インデックスを使ってオブジェクトを検索する前に [トークナイズ](../config-refs/collections.mdx#tokenization) されます。

[各プロパティ](../manage-collections/vector-config.mdx#property-level-settings) のコレクション定義で、使用するトークナイゼーション方式を指定する必要があります。

import TknPyCode from '!!raw-loader!/_includes/code/howto/manage-data.collections.py';
import TknPyCodeV3 from '!!raw-loader!/_includes/code/howto/manage-data.collections-v3.py';
import TknTsCode from '!!raw-loader!/_includes/code/howto/manage-data.collections.ts';
import TknTsCodeLegacy from '!!raw-loader!/_includes/code/howto/manage-data.collections-v2.ts';


<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={TknPyCode}
      startMarker="# START PropModuleSettings"
      endMarker="# END PropModuleSettings"
      language="py"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={TknPyCodeV3}
      startMarker="# START PropModuleSettings"
      endMarker="# END PropModuleSettings"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TknTsCode}
      startMarker="// START PropModuleSettings"
      endMarker="// END PropModuleSettings"
      language="ts"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TknTsCodeLegacy}
      startMarker="// START PropModuleSettings"
      endMarker="// END PropModuleSettings"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START PropModuleSettings"
      endMarker="// END PropModuleSettings"
      language="java"
    />
  </TabItem>
</Tabs>
## `limit` と `offset`

`limit` を使用して、返されるオブジェクト数の上限を固定します。  
必要に応じて、`offset` を使用して結果をページングします。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START limit Python"
      endMarker="# END limit Python"
      language="py"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# START limit Python"
      endMarker="# END limit Python"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START limit"
      endMarker="// END limit"
      language="ts"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START limit"
      endMarker="// END limit"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START limit"
      endMarker="// END limit"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START limit"
      endMarker="// END limit"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# START limit GraphQL"
      endMarker="# END limit GraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

## 結果グループの制限

クエリとの距離が近い結果をグループ単位で制限するには、[`autocut`](../api/graphql/additional-operators.md#autocut) フィルターを使用して返すグループ数を指定します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START autocut Python"
      endMarker="# END autocut Python"
      language="py"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# START autocut Python"
      endMarker="# END autocut Python"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START autocut"
      endMarker="// END autocut"
      language="ts"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START autocut"
      endMarker="// END autocut"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START autocut"
      endMarker="// END autocut"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START autocut"
      endMarker="// END autocut"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# START autocut GraphQL"
      endMarker="# END autocut GraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>レスポンス例</summary>

レスポンス例:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# START Expected autocut results"
  endMarker="# END Expected autocut results"
  language="json"
/>

</details>
## 結果のグループ化

:::info `v1.25` で追加
:::

検索結果をグループ化するための基準を定義します。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# START BM25GroupByPy4"
      endMarker="# END BM25GroupByPy4"
      language="py"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START BM25GroupBy"
      endMarker="// END BM25GroupBy"
      language="java"
    />
  </TabItem>
</Tabs>

<details>
  <summary>レスポンス例</summary>

レスポンスは次のようになります:

```
'Jeopardy!'
'Double Jeopardy!'
```

</details>

## 結果のフィルタリング

より具体的な結果を得るには、[`filter`](../api/graphql/filters.md) を使用して検索範囲を絞り込みます。

<Tabs groupId="languages">
  <TabItem value="py" label="Python Client v4">
    <FilteredTextBlock
      text={PyCode}
      startMarker="# BM25WithFilterPython"
      endMarker="# END BM25WithFilterPython"
      language="python"
    />
  </TabItem>

  <TabItem value="py3" label="Python Client v3">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithFilterPython"
      endMarker="# END BM25WithFilterPython"
      language="pyv3"
    />
  </TabItem>

  <TabItem value="js" label="JS/TS Client v3">
    <FilteredTextBlock
      text={TSCode}
      startMarker="// START Filter"
      endMarker="// END Filter"
      language="js"
    />
  </TabItem>

  <TabItem value="js2" label="JS/TS Client v2">
    <FilteredTextBlock
      text={TSCodeLegacy}
      startMarker="// START Filter"
      endMarker="// END Filter"
      language="tsv2"
    />
  </TabItem>

  <TabItem value="go" label="Go">
    <FilteredTextBlock
      text={GoCode}
      startMarker="// START Filter"
      endMarker="// END Filter"
      language="go"
    />
  </TabItem>

  <TabItem value="java" label="Java">
    <FilteredTextBlock
      text={JavaCode}
      startMarker="// START Filter"
      endMarker="// END Filter"
      language="java"
    />
  </TabItem>

  <TabItem value="graphql" label="GraphQL">
    <FilteredTextBlock
      text={PyCodeV3}
      startMarker="# BM25WithFilterGraphQL"
      endMarker="# END BM25WithFilterGraphQL"
      language="graphql"
    />
  </TabItem>
</Tabs>

<details>
  <summary>レスポンス例</summary>

レスポンスは次のようになります:

<FilteredTextBlock
  text={PyCodeV3}
  startMarker="# Expected BM25WithFilter results"
  endMarker="# END Expected BM25WithFilter results"
  language="json"
/>

</details>

### トークン化

import TokenizationNote from '/_includes/tokenization.mdx'

<TokenizationNote />
## 関連ページ

- [Weaviate に接続する](/weaviate/connections/index.mdx)
- [API リファレンス: 検索演算子 # BM25](../api/graphql/search-operators.md#bm25)
- [Weaviate Academy: トークナイゼーション](../../academy/py/tokenization/index.md)

## 質問とフィードバック

import DocsFeedback from '/_includes/docs-feedback.mdx';

<DocsFeedback/>